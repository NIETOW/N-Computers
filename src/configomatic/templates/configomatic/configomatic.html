{% extends 'base.html' %}

{% block content %}
<div class="grid grid-cols-2">
    <div class="bg-gray-50 shadow-md rounded-lg w-full p-4 mt-4">
        <h1 class="text-2xl font-bold mb-4">Configurez votre PC !</h1>

        <form method="post" action="{% url 'configomatic' %}" class="mx-auto">
            {% csrf_token %}

            <div class="mb-4">
                <label for="processeur" class="font-semibold text-xl block">Processeur:</label>
                <select name="processeur" id="processeur" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for processeur in processeurs %}
                    <option value="{{ processeur.id }}" data-prix="{{ processeur.price }}"
                            data-thumbnail="{{ processeur.thumbnail.url }}" data-socket="{{ processeur.socket }}">
                        {{ processeur.name }} - {{ processeur.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="carte_graphique" class="font-semibold text-xl block">Carte graphique:</label>
                <select name="carte_graphique" id="carte_graphique" class="border border-gray-300 p-2 rounded-lg w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for carte_graphique in cartes_graphiques %}
                    <option value="{{ carte_graphique.id }}" data-prix="{{ carte_graphique.price }}"
                            data-thumbnail="{{ carte_graphique.thumbnail.url }}">
                        {{ carte_graphique.name }} - {{ carte_graphique.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="carte_mere" class="font-semibold text-xl block">Carte mère:</label>
                <select name="carte_mere" id="carte_mere" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for carte_mere in cartes_meres %}
                    <option value="{{ carte_mere.id }}" data-prix="{{ carte_mere.price }}"
                            data-thumbnail="{{ carte_mere.thumbnail.url }}" data-typeram="{{ carte_mere.typeRAM }}"
                            data-m2="{{ carte_mere.m2 }}">
                        {{ carte_mere.name }} - {{ carte_mere.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="memoire_vive" class="font-semibold text-xl block">Mémoire vive:</label>
                <select name="memoire_vive" id="memoire_vive" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for memoire_vive in memoires_vives %}
                    <option value="{{ memoire_vive.id }}" data-prix="{{ memoire_vive.price }}"
                            data-thumbnail="{{ memoire_vive.thumbnail.url }}" data-typeram="{{ memoire_vive.typeRAM }}"
                            class="memoire-vive-option {{ memoire_vive.typeRAM }}">
                        {{ memoire_vive.name }} - {{ memoire_vive.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>


            <div class="mb-4">
                <label for="ssd" class="font-semibold text-xl block">SSD:</label>
                <select name="ssd" id="ssd" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for ssd in ssd %}
                    <option value="{{ ssd.id }}" data-prix="{{ ssd.price }}" data-thumbnail="{{ ssd.thumbnail.url }}"
                            class="ssd-option">
                        {{ ssd.name }} - {{ ssd.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="disque_dur" class="font-semibold text-xl block">Disque dur:</label>
                <select name="disque_dur" id="disque_dur" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for disque_dur in disques_durs %}
                    <option value="{{ disque_dur.id }}" data-prix="{{ disque_dur.price }}"
                            data-thumbnail="{{ disque_dur.thumbnail.url }}">
                        {{ disque_dur.name }} - {{ disque_dur.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="alimentation" class="font-semibold text-xl block">Alimentation:</label>
                <select name="alimentation" id="alimentation" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for alimentation in alimentations %}
                    <option value="{{ alimentation.id }}" data-prix="{{ alimentation.price }}"
                            data-thumbnail="{{ alimentation.thumbnail.url }}">
                        {{ alimentation.name }} - {{ alimentation.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="boitier" class="font-semibold text-xl block">Boitier:</label>
                <select name="boitier" id="boitier" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for boitier in boitiers %}
                    <option value="{{ boitier.id }}" data-prix="{{ boitier.price }}"
                            data-thumbnail="{{ boitier.thumbnail.url }}">
                        {{ boitier.name }} - {{ boitier.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-4">
                <label for="refroidissement" class="font-semibold text-xl block">Refroidissement:</label>
                <select name="refroidissement" id="refroidissement" class="border border-gray-300 rounded-lg p-2 w-2/3">
                    <option value="">-- Sélectionnez une option --</option>
                    {% for refroidissement in refroidissements %}
                    <option value="{{ refroidissement.id }}" data-prix="{{ refroidissement.price }}"
                            data-thumbnail="{{ refroidissement.thumbnail.url }}">
                        {{ refroidissement.name }} - {{ refroidissement.price }}€
                    </option>
                    {% endfor %}
                </select>
            </div>
            <button class="inline-block bg-indigo-600 text-white rounded-full px-4 py-2 mt-4 hover:bg-indigo-700"
                    id="reinitialiser" onclick="reinitialiserSelections()">Réinitialiser
            </button>

        </form>
    </div>

    <div>
        <div id="recapitulatif" class="bg-gray-50 shadow-md rounded-lg p-4 my-8 mx-auto w-2/3 mt-4">
            <h2 class="text-xl font-bold mb-4">Récapitulatif de la configuration :</h2>
            <ul id="composants-selectionnes" class="font-semibold mb-4 text-lg pl-4"></ul>
            <p id="prix-total" class="text-xl w-1/3 mt-8 font-semibold">Prix total : 0€</p>
        </div>

        <script>

     // Fonction pour sauvegarder les sélections dans le stockage local
    function sauvegarderSelections() {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        const id = select.id;
        const selectedIndex = select.selectedIndex;
        localStorage.setItem(id, selectedIndex);
      });
    }

    // Fonction pour charger les sélections depuis le stockage local
    function chargerSelections() {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        const id = select.id;
        const selectedIndex = localStorage.getItem(id);
        if (selectedIndex !== null) {
          select.selectedIndex = selectedIndex;
        }
      });
    }

    function reinitialiserSelections() {
  const selects = document.querySelectorAll('select');
  selects.forEach(select => {
    select.selectedIndex = 0; // Réinitialiser la sélection à l'option par défaut
    localStorage.removeItem(select.id); // Supprimer l'élément correspondant du stockage local
  });

  updateRecapitulatif(); // Mettre à jour le récapitulatif après la réinitialisation
}


    function updateRecapitulatif() {
      const processeurSelect = document.getElementById('processeur');
      const carteGraphiqueSelect = document.getElementById('carte_graphique');
      const carteMereSelect = document.getElementById('carte_mere');
      const memoireViveSelect = document.getElementById('memoire_vive');
      const ssdSelect = document.getElementById('ssd');
      const disqueDurSelect = document.getElementById('disque_dur');
      const alimentationSelect = document.getElementById('alimentation');
      const boitierSelect = document.getElementById('boitier');
      const refroidissementSelect = document.getElementById('refroidissement');

      const composantsSelectionnes = document.getElementById('composants-selectionnes');
      const prixTotalElement = document.getElementById('prix-total');
      const thumbnailSize = 'w-1/3';

      let prixTotal = 0;
      composantsSelectionnes.innerHTML = '';

      let selectedOption = processeurSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixProcesseur = parseFloat(processeurSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const processeurThumbnail = processeurSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + processeurSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + processeurThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixProcesseur;
      }

      selectedOption = carteGraphiqueSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixCarteGraphique = parseFloat(carteGraphiqueSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const carteGraphiqueThumbnail = carteGraphiqueSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + carteGraphiqueSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + carteGraphiqueThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixCarteGraphique;
      }

      selectedOption = carteMereSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixCarteMere = parseFloat(carteMereSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const carteMereThumbnail = carteMereSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + carteMereSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + carteMereThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixCarteMere;
      }

      selectedOption = memoireViveSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixMemoireVive = parseFloat(memoireViveSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const memoireViveThumbnail = memoireViveSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + memoireViveSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + memoireViveThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixMemoireVive;
      }

      selectedOption = ssdSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixSSD = parseFloat(ssdSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const ssdThumbnail = ssdSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + ssdSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + ssdThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixSSD;
      }

      selectedOption = disqueDurSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixDisqueDur = parseFloat(disqueDurSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const disqueDurThumbnail = disqueDurSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + disqueDurSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + disqueDurThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixDisqueDur;
      }

      selectedOption = alimentationSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixAlimentation = parseFloat(alimentationSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const alimentationThumbnail = alimentationSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + alimentationSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + alimentationThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixAlimentation;
      }

      selectedOption = boitierSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixBoitier = parseFloat(boitierSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const boitierThumbnail = boitierSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + boitierSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + boitierThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixBoitier;
      }

      selectedOption = refroidissementSelect.selectedIndex;
      if (selectedOption !== 0) {
        const prixRefroidissement = parseFloat(refroidissementSelect.options[selectedOption].getAttribute('data-prix').replace(',', '.'));
        const refroidissementThumbnail = refroidissementSelect.options[selectedOption].getAttribute('data-thumbnail');
        composantsSelectionnes.innerHTML += '<li class="mb-4">' + refroidissementSelect.options[selectedOption].text + '</li>';
        composantsSelectionnes.innerHTML += '<li class="mb-4"><img src="' + refroidissementThumbnail + '" alt="Thumbnail" class="' + thumbnailSize + '"></li>';
        prixTotal += prixRefroidissement;
      }

      prixTotalElement.innerText = 'Prix total : ' + prixTotal.toFixed(2) + ' €';
      sauvegarderSelections();
    }

document.addEventListener('DOMContentLoaded', function() {
  var carteMereSelect = document.getElementById('carte_mere');
  var processeurSelect = document.getElementById('processeur');
  var processeurOptions = processeurSelect.querySelectorAll('option');

  carteMereSelect.addEventListener('change', function() {
    var selectedSocket = carteMereSelect.options[carteMereSelect.selectedIndex].value;

    if (selectedSocket === '') {
      // Si aucune carte mère n'est sélectionnée, afficher toutes les options de processeurs
      for (var i = 0; i < processeurOptions.length; i++) {
        var option = processeurOptions[i];
        option.style.display = 'block';
      }
    } else {
      // Sinon, afficher uniquement les processeurs ayant le même socket que la carte mère sélectionnée
      for (var i = 0; i < processeurOptions.length; i++) {
        var option = processeurOptions[i];
        var socket = option.getAttribute('data-socket');

        if (socket === selectedSocket) {
          option.style.display = 'block';
        } else {
          option.style.display = 'none';
        }
      }
    }
  });
});


function updateSSDM2Options() {
  const carteMereSelect = document.getElementById('carte_mere');
  const ssdOptions = document.getElementById('ssd-option');
  const ssdSelect = document.getElementById('ssd');

  const carteMereOption = carteMereSelect.options[carteMereSelect.selectedIndex];
  const carteMereM2 = carteMereOption.getAttribute('data-m2');

  // Si aucune carte mère n'est sélectionnée
  if (!carteMereOption.value) {
    // Afficher toutes les options du SSD
    ssd.style.display = 'block';
    for (var i = 0; i < ssdOptions.length; i++) {
      var option = ssdOptions[i];
      option.style.display = 'block';
    }
  } else if (carteMereM2 === 'True') {
    // Afficher le conteneur SSD
    ssd.style.display = 'block';
    // Effacer les options du SSD non-M.2
    for (var i = 0; i < ssdOptions.length; i++) {
      var option = ssdOptions[i];
      if (option.getAttribute('data-m2') === 'True') {
        option.style.display = 'none';
      }
    }
  } else {
    // Masquer le conteneur SSD
    ssd.style.display = 'none';
    // Effacer les options du SSD M.2
    for (var i = 0; i < ssdOptions.length; i++) {
      var option = ssdOptions[i];
      if (option.getAttribute('data-m2') === 'True') {
        option.style.display = 'none';
      }
    }
  }
}

// Appeler la fonction lors du chargement de la page
document.addEventListener('DOMContentLoaded', updateSSDM2Options);

// Appeler la fonction lorsque la sélection de la carte mère est modifiée
const carteMereSelect = document.getElementById('carte_mere');
carteMereSelect.addEventListener('change', updateSSDM2Options);




    document.addEventListener('DOMContentLoaded', function() {
  var carteMereSelect = document.getElementById('carte_mere');
  var memoireViveSelect = document.getElementById('memoire_vive');
  var memoireViveOptions = memoireViveSelect.querySelectorAll('.memoire-vive-option');

  carteMereSelect.addEventListener('change', function() {
    var selectedTypeRAM = carteMereSelect.options[carteMereSelect.selectedIndex].getAttribute('data-typeram');

    if (selectedTypeRAM === '') {
      // Si aucune carte mère n'est sélectionnée, afficher toutes les options de mémoire vive
      for (var i = 0; i < memoireViveOptions.length; i++) {
        var option = memoireViveOptions[i];
        option.style.display = 'block';
      }
    } else {
      // Sinon, afficher uniquement les options correspondant au type de RAM de la carte mère sélectionnée
      for (var i = 0; i < memoireViveOptions.length; i++) {
        var option = memoireViveOptions[i];

        if (option.classList.contains(selectedTypeRAM)) {
          option.style.display = 'block';
        } else {
          option.style.display = 'none';
        }
      }
    }
  });
});


    document.addEventListener('DOMContentLoaded', chargerSelections);
    const selects = document.querySelectorAll('select');
    selects.forEach(select => select.addEventListener('change', updateRecapitulatif));





        </script>
    </div>
</div>
{% endblock %}






